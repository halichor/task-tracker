<!DOCTYPE html>
<html lang="en">

<!-- TO DO:
    1. Backup and import tasks and users
    2. Firebase integration after github hosting (requires DB)
-->

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Task Manager with Users & Admin</title>

    <!-- Scripts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap.min.css"
        rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>

<body>

    <!-- LOGIN SCREEN -->
    <div id="auth" class="container" style="max-width: 400px;">
        <h3 class="mb-4">Please Log In</h3>
        <div class="mb-3">
            <input type="text" id="login-username" class="form-control" placeholder="Username"
                autocomplete="username" />
        </div>
        <div class="mb-3">
            <input type="password" id="login-password" class="form-control" placeholder="Password"
                autocomplete="current-password" />
        </div>
        <button id="login-btn" class="btn btn-primary w-100">Login</button>
        <div id="login-error" class="text-danger mt-3"></div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="container">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Task Manager - User: <span id="current-user-name"></span></h3>
            <button id="logout-btn" class="btn btn-outline-secondary">Logout</button>
        </div>

        <ul class="nav nav-tabs mb-3" id="main-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today"
                    type="button" role="tab">Today</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="archive-tab" data-bs-toggle="tab" data-bs-target="#archive" type="button"
                    role="tab">Archive</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="view-users-tab" data-bs-toggle="tab" data-bs-target="#view-users"
                    type="button" role="tab">View Tasks</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button"
                    role="tab">Settings</button>
            </li>
        </ul>

        <div class="tab-content" id="main-tabs-content">
            <!-- Today Tab -->
            <div class="tab-pane fade show active" id="today" role="tabpanel" aria-labelledby="today-tab">
                <div class="mb-3 d-flex gap-2">
                    <select id="task-origin-input" class="form-select" style="max-width:160px;"></select>
                    <input type="text" id="task-activity-input" class="form-control" placeholder="Activity" />
                    <input type="text" id="task-remarks-input" class="form-control" placeholder="Remarks" />
                    <input type="text" id="task-date-input" class="form-control" style="max-width:160px;" />
                    <input type="text" id="task-tags-input" class="form-control" placeholder="Tags (comma separated)"
                        style="max-width:180px;" />
                </div>
                <button class="btn btn-primary mb-3" id="add-task-btn">Add Task</button>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Today's Tasks</h5>
                    <div id="today-edit-controls" style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-outline-secondary btn-sm" id="today-edit-btn">
                            <span id="today-edit-btn-label">EDIT</span>
                        </button>
                        <button class="btn btn-danger btn-sm" id="today-delete-selected-btn" style="display:none;">
                            Delete Selected
                        </button>
                    </div>
                </div>
                <div id="today-tasks-list" class="mb-4"></div>
            </div>

            <!-- Archive Tab -->
            <div class="tab-pane fade" id="archive" role="tabpanel" aria-labelledby="archive-tab">
                <div class="mb-3">
                    <div id="datepicker" class="datepicker-inline"></div>

                    <!-- Cols Fixed-->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5>Tasks on <span id="archive-date-display">[select a date]</span></h5>
                        <div id="today-edit-controls" style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-outline-secondary btn-sm" id="archive-edit-btn">
                                <span id="archive-edit-btn-label">EDIT</span>
                            </button>
                            <button class="btn btn-danger btn-sm" id="archive-delete-selected-btn"
                                style="display:none;">
                                Delete Selected
                            </button>
                        </div>
                    </div>

                    <div id="archive-tasks-list"></div>
                </div>
            </div>

            <!-- View Tasks Tab -->
            <div class="tab-pane fade" id="view-users" role="tabpanel" aria-labelledby="view-users-tab">
                <div class="mb-3">
                    <label for="view-tasks-date" class="form-label">Select Date:</label>
                    <div class="input-group date" id="view-tasks-date-group" data-date-format="yyyy-mm-dd"
                        data-date-autoclose="true" data-date-today-highlight="true">
                        <input type="text" id="view-tasks-date" class="form-control" readonly
                            style="background:#fff; cursor:pointer; max-width:200px;" />
                        <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                    </div>
                </div>
                <div id="users-tasks-table-container"></div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <div class="row">
                    <!-- Sidebar as Bootstrap nav-pills flex-column -->
                    <div class="col-md-4">
                        <ul class="nav nav-pills flex-column mb-3" id="settings-sidebar" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="sidebar-account-btn" data-bs-toggle="pill"
                                    data-bs-target="#account-section" type="button" role="tab">Account Settings</button>
                            </li>
                            <li class="nav-item" role="presentation" id="sidebar-user-mgmt-li" style="display:none;">
                                <button class="nav-link" id="sidebar-user-mgmt-btn" data-bs-toggle="pill"
                                    data-bs-target="#user-mgmt-section" type="button" role="tab">User
                                    Management</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sidebar-task-mgmt-btn" data-bs-toggle="pill"
                                    data-bs-target="#task-mgmt-section" type="button" role="tab">Task
                                    Management</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sidebar-mass-editor-btn" data-bs-toggle="pill"
                                    data-bs-target="#mass-editor-section" type="button" role="tab">Mass Task
                                    Editor</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sidebar-backup-btn" data-bs-toggle="pill"
                                    data-bs-target="#backup-section" type="button" role="tab">Backup, Import and
                                    Export</button>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-8">
                        <div class="tab-content">
                            <!-- Account Settings Tab -->
                            <div class="tab-pane fade show active" id="account-section" role="tabpanel">
                                <h5>Change Username and Password</h5>
                                <div class="mb-3">
                                    <label for="new-username" class="form-label">New Username</label>
                                    <input type="text" id="new-username" class="form-control" />
                                </div>
                                <div class="mb-3">
                                    <label for="new-password" class="form-label">New Password</label>
                                    <input type="password" id="new-password" class="form-control" />
                                </div>
                                <button class="btn btn-primary" id="save-settings-btn">Save Changes</button>
                            </div>
                            <!-- User Management Tab (admin only) -->
                            <div class="tab-pane fade" id="user-mgmt-section" role="tabpanel">
                                <h5>User Management</h5>
                                <div id="admin-user-mgmt">
                                    <div class="mb-3">
                                        <label for="admin-new-username" class="form-label">New Username</label>
                                        <input type="text" id="admin-new-username" class="form-control" />
                                    </div>
                                    <div class="mb-3">
                                        <label for="admin-new-password" class="form-label">New Password</label>
                                        <input type="password" id="admin-new-password" class="form-control" />
                                    </div>
                                    <button class="btn btn-success mb-3" id="admin-create-user-btn">Create User</button>
                                    <h6>Existing Users</h6>
                                    <ul id="user-list" class="list-group"></ul>
                                </div>
                            </div>
                            <!-- Task Management Tab -->
                            <div class="tab-pane fade" id="task-mgmt-section" role="tabpanel">
                                <!-- Holidays -->
                                <h5>Holidays</h5>
                                <div class="mb-3">
                                    <label for="holiday-datepicker" class="form-label">Select Date:</label>
                                    <div id="holiday-datepicker"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="holiday-name" class="form-label">Holiday Name</label>
                                    <input type="text" id="holiday-name" class="form-control"
                                        placeholder="e.g. New Year's Day" />
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="holiday-repeat" />
                                    <label class="form-check-label" for="holiday-repeat">
                                        Repeat every year
                                    </label>
                                </div>
                                <button class="btn btn-primary mb-2" id="add-holiday-btn">Add Holiday</button>
                                <div id="holidays-list"></div>

                                <!-- Manage Origins Tab (admin only, shown via JS) -->
                                <div id="origins-admin-section" style="display:none; margin-top:2em;">
                                    <h5>Manage Origins</h5>
                                    <div class="mb-3 d-flex">
                                        <input id="new-origin-input" class="form-control me-2"
                                            placeholder="New origin..." />
                                        <button id="add-origin-btn" class="btn btn-primary">Add</button>
                                    </div>
                                    <div id="origins-admin-list"></div>
                                    <small class="text-muted">Origins cannot be deleted, only archived/unarchived.
                                        Editing an origin will update all tasks using it.</small>
                                </div>
                            </div>
                            <!-- Mass Task Editor Tab -->
                            <div class="tab-pane fade" id="mass-editor-section" role="tabpanel">
                                <h5>Mass Task Editor</h5>
                                <div id="mass-editor-user-select-container" class="mb-3" style="display:none;">
                                    <label for="mass-editor-user-select" class="form-label">Select User:</label>
                                    <select id="mass-editor-user-select" class="form-select"
                                        style="max-width:200px;"></select>
                                </div>
                                <div class="mb-3 d-flex flex-wrap gap-2 align-items-end">
                                    <div>
                                        <label class="form-label">Filter:</label>
                                        <select id="mass-editor-filter-type" class="form-select">
                                            <option value="all">All</option>
                                            <option value="month">Month</option>
                                            <option value="week">Week</option>
                                            <option value="range">Custom Range</option>
                                            <option value="daterange">Date Range</option>
                                        </select>
                                    </div>
                                    <div id="mass-editor-filter-month" style="display:none;">
                                        <input type="month" id="mass-editor-month" class="form-control" />
                                    </div>
                                    <div id="mass-editor-filter-week" style="display:none;">
                                        <input type="week" id="mass-editor-week" class="form-control" />
                                    </div>
                                    <div id="mass-editor-filter-range" style="display:none;">
                                        <input type="text" id="mass-editor-range" class="form-control"
                                            placeholder="Select multiple dates" readonly
                                            style="background:#fff; cursor:pointer; max-width:220px;" />
                                    </div>
                                    <div id="mass-editor-filter-daterange" style="display:none;">
                                        <div class="input-group input-daterange">
                                            <input type="text" id="mass-editor-range-start" class="form-control"
                                                placeholder="Start date" readonly>
                                            <span class="input-group-text">to</span>
                                            <input type="text" id="mass-editor-range-end" class="form-control"
                                                placeholder="End date" readonly>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" id="mass-editor-apply-filter-btn">Apply
                                        Filter</button>
                                </div>
                                <div class="d-flex gap-2 mb-2">
                                    <button class="btn btn-outline-secondary btn-sm" id="mass-editor-edit-btn">
                                        <span id="mass-editor-edit-btn-label">EDIT</span>
                                    </button>
                                    <button class="btn btn-danger btn-sm" id="mass-editor-delete-selected-btn"
                                        style="display:none;">
                                        Delete Selected
                                    </button>
                                </div>
                                <div id="mass-editor-tasks-list"></div>
                            </div>
                            <!-- Backup, Import and Export Tab -->
                            <div class="tab-pane fade" id="backup-section" role="tabpanel">
                                <h5>Backup, Import and Export</h5>
                                <div id="backup-user-section">
                                    <button class="btn btn-outline-primary mb-2" id="export-my-tasks-btn">Export My
                                        Tasks</button>
                                    <input type="file" id="import-my-tasks-input" style="display:none;"
                                        accept=".json" />
                                    <button class="btn btn-outline-secondary mb-2" id="import-my-tasks-btn">Import My
                                        Tasks</button>
                                    <div id="import-my-tasks-status" class="mt-2"></div>
                                </div>
                                <div id="backup-admin-section" style="display:none;">
                                    <hr>
                                    <h6>Admin: All Users</h6>
                                    <button class="btn btn-outline-primary mb-2" id="export-all-users-btn">Export All
                                        Users & Tasks (ZIP)</button>
                                    <input type="file" id="import-all-users-input" style="display:none;"
                                        accept=".zip,.json" />
                                    <button class="btn btn-outline-secondary mb-2" id="import-all-users-btn">Import
                                        Users/Tasks</button>
                                    <div id="import-all-users-status" class="mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Modals ===== -->
        <!-- Confirmation Modal -->
        <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmModalLabel">Please Confirm</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="confirmModalBody">
                        <!-- Message goes here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="confirmModalCancel"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirmModalOk">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Modal -->
        <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="alertModalLabel">Alert</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="alertModalBody"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="alertModalOk"
                            data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Modal -->
        <div id="confirm-modal" class="modal" tabindex="-1" style="display:none;">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Please Confirm</h5>
                    </div>
                    <div class="modal-body">
                        <p id="confirm-modal-message"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="confirm-modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                        <button type="button" id="confirm-modal-ok-btn" class="btn btn-primary">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Modal -->
        <div id="prompt-modal" class="modal" tabindex="-1" style="display:none;">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Input Required</h5>
                    </div>
                    <div class="modal-body">
                        <p id="prompt-modal-message"></p>
                        <input type="text" id="prompt-modal-input" class="form-control" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="prompt-modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                        <button type="button" id="prompt-modal-ok-btn" class="btn btn-primary">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Scripts ===== -->

        <!-- Prereq Script -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

        <!-- Firebase App (the core Firebase SDK) -->
        <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
        <!-- Firebase Firestore (the database) -->
        <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
        <script>
            // Your Firebase config
            const firebaseConfig = {
                apiKey: "AIzaSyCkaLhIvt_Plf8h4B1ImxDN-e3pg_tABD0",
                authDomain: "task-tracker-c3fd6.firebaseapp.com",
                projectId: "task-tracker-c3fd6",
                storageBucket: "task-tracker-c3fd6.firebasestorage.app",
                messagingSenderId: "946848839661",
                appId: "1:946848839661:web:37486cc58c1e14a63059e4",
                measurementId: "G-CDG3DWTF93"
            };
            firebase.initializeApp(firebaseConfig);
            window.db = firebase.firestore();
        </script>

        <!-- Main Script -->
        <script src="script.js"></script>

    </div>
</body>

</html>